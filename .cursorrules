# Aivolution Projekt-Regeln

## Design-Vorgaben (Brand-Identity)
- Stil: Futuristisch-modern, brutalistisch.
- Elemente: Abgerundete Ecken [2.5rem], starke Kontraste.
- Farbschema: Schwarz, Rot, Weiß.
- Qualitätsanspruch: "Crunchy" und hochwertig, kein Standard-Template-Look.
- **UI-Philosophie:** Dezent und clean. Lieber kleine Menüs/Panels als wuchtige Elemente.

## Plattform-Architektur & Features

### Rollen-System (3 Ebenen):
1. **user:** Basis-Account (Community nutzen, kaufen) - kein Verkauf
2. **creator:** User nach Onboarding-Freischaltung (kann verkaufen)
3. **moderation:** Moderatoren (können Inhalte kuratieren, Profile pausieren, Songs/Alben löschen)
4. **admin:** Vollzugriff (kann alles + Moderatoren verwalten)

### Creator-Onboarding Workflow (BEST PRACTICE):
**WICHTIG:** Bevorzuge IMMER diesen schlanken Flow (keine Multi-Step-Formulare mit Redirects).

**Phase 1: Registrierung**
- AGBs/Richtlinien/Checkboxen VORHER zeigen (editierbar via Admin-Panel)
- Magic Link anfordern (Email-Bestätigung = Spam-Schutz)
- User klickt Link → Session aktiv

**Phase 2: Profil-Erstellung (All-in-One)**
- **EIN Formular** (nicht Steps!) mit:
  - Artist Name, Bio, Tech-Stack, Social Links
  - 2 Songs hochladen (**WAV-Format** für Verkauf)
  - System erstellt automatisch **30-Sek-MP3-Preview** (Server-Side mit ffmpeg)
- **Speichern:** Profile + Songs in EINER Transaction
- **Status:** `locked` (Schloss-Symbol: "Wartet auf Freischaltung")

**Phase 3: Freischaltung**
- Admin prüft in Kuration (Songs anhören, Profil checken)
- Automatischer Filter läuft parallel (Grundgesetz, Bad-Words)
- Admin schaltet frei → `role = 'creator'`, Status `active`

**Technische Vorteile:**
- Weniger Redirects (stabiler)
- Weniger DB-Calls (performanter)
- Client-Side Profile-Creation (RLS funktioniert, weil Session aktiv)
- Einfacher zu debuggen (weniger Moving Parts)
- Klarer Status-Flow (locked → active)

### Admin/Moderation-Funktionen (Kommandozentrale):
- **Kuration:**
  - Namenssuche (Suchleiste für Creator-Profile)
  - Bewerbungen prüfen & freischalten/ablehnen
  - **Direkt-Editierung:** Als Admin direkt in fremden Profilen editieren können
  - Profile pausieren/sperren
  - Songs & Alben löschen
- **Design:** Dezente Suchleiste, kompakte Panels (nicht zu wuchtig)

### RLS (Row Level Security):
- User: Nur eigene Daten sehen/editieren
- Moderation: Alle Creator-Daten sehen, editieren, pausieren
- Admin: Vollzugriff + Moderatoren-Verwaltung

## Die 6 Master-Fragen für jede Code-Generierung:
1. **Scaling (Performance):** Funktioniert dieser Code auch bei 100.000 Datenbank-Einträgen (Pagination/Indizes)?
2. **Security (Bad User):** Sind die Supabase RLS Policies so gesetzt, dass kein Nutzer fremde Daten sehen oder löschen kann?
3. **Murphy's Law (Stabilität):** Verbleiben Datenleichen, wenn der User mitten im Prozess den Browser schließt?
4. **Tech-Stack (Aktualität):** Ist das State-of-the-Art Next.js (App Router) oder veralteter Code?
5. **Brand-Identity (Design):** Entspricht das UI dem brutalistischen Aivolution-Stil (2.5rem Corners)?
6. **Legal-Check (Rechtssicherheit):** Wird diese Creator-Funktion im Einklang mit relevanten Gesetzen erstellt? (Besonders: Monitoring der 30-Verkäufe-Grenze pro Jahr für die Meldepflicht an Behörden).

## Tech-Stack-Spezifika (Next.js 16 + Codespaces)
**WICHTIG:** Diese Erkenntnisse sind verifiziert und dürfen NICHT durch veraltete Lösungen ersetzt werden.

### Next.js 16 Anforderungen:
- **Proxy statt Middleware:** Dateiname muss `src/proxy.ts` heißen (NICHT `middleware.ts`).
  - Export: `export default async function proxy(request: NextRequest) { ... }`
  - Grund: Next.js 16 hat "middleware" deprecated zugunsten von "proxy".
  
### Codespaces Setup:
- **Server Actions Config:** `next.config.ts` MUSS `serverActions.allowedOrigins` enthalten:
  ```ts
  experimental: {
    serverActions: {
      allowedOrigins: ['localhost:3000', '*.app.github.dev']
    }
  }
  ```
  - Ohne diese Config gibt es "Invalid Server Actions request" Fehler.
  
- **Port 3000 ist Pflicht:** Die Codespace-URL endet auf `-3000.app.github.dev`.
  - Bei Port-Konflikten: `pkill -f node` und neu starten.
  - Cache-Probleme: `rm -rf .next` vor Neustart.

### Supabase Integration:
- **Admin-Check:** Immer via `supabase.rpc('get_my_role')` (NICHT direkter Tabellen-Zugriff).
  - Grund: Umgeht RLS-Probleme und Spalten-Permissions.
  
### Deployment-Workflow (lokal → Codespace):
1. Lokal: `git add . && git commit -m "..." && git push origin main`
2. Codespace: `git pull` + Server neu starten
3. **KEINE** alternativen Sync-Methoden verwenden (führt zu Inkonsistenzen).

## Arbeitsweise
- Gib immer den vollständig adaptierten Code aus.
- Optimiere nicht nur den Schreibstil, sondern achte auf saubere Struktur, damit der Code nicht "unclean" wird.
- Nutze die informelle Du-Form.
- **Bei Fehlern:** Prüfe ZUERST die "Tech-Stack-Spezifika" oben, bevor alte Lösungen angewendet werden.
